<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动态消除转盘</title>
    <style>
        /* 1. 基础布局和样式 */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
            font-family: Arial, sans-serif;
        }

        /* 2. 转盘容器 */
        .wheel-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin-bottom: 30px;
        }

        /* 3. 转盘本体 */
        .wheel {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            /* CSS 变量: --segments-count 选项数量，在 JS 中更新 */
            /* CSS 变量: --rotation-degree 累计旋转角度，在 JS 中更新 */
            transform: rotate(var(--rotation-degree, 0deg));
            transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1.0); /* 旋转动画效果 */
        }

        /* 4. 每个选项的样式 */
        .segment {
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 50%;
            /* 剪切路径创建扇形 */
            clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%); 
            transform-origin: 100% 100%; /* 旋转中心点为右下角 */
            /* CSS 变量: --segment-angle 每个选项的角度 */
            /* CSS 变量: --segment-index 选项的索引 */
            transform: rotate(calc(var(--segment-angle) * var(--segment-index)));
            display: flex;
            justify-content: center;
            align-items: flex-start; /* 文字靠近圆心 */
            padding-top: 15px;
            box-sizing: border-box;
            border: 1px solid #ccc; /* 选项之间的边界 */
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }
        /* 移除时的样式 */
        .segment.removed {
            opacity: 0;
            pointer-events: none; /* 移除后不可交互 */
        }
        
        /* 选项文字的样式 */
        .segment-text {
            color: #333;
            font-weight: bold;
            font-size: 1.1em;
            /* 逆向旋转文字，使其保持水平 */
            transform: rotate(calc(360deg / var(--segments-count) * -1 / 2)); 
        }

        /* 选项背景颜色（为不同选项添加颜色） */
        .segment:nth-child(1) { background-color: #ff9999; }
        .segment:nth-child(2) { background-color: #99ccff; }
        .segment:nth-child(3) { background-color: #99ff99; }
        .segment:nth-child(4) { background-color: #ffff99; }
        /* 更多的选项可以继续添加... */
        
        /* 5. 指针/指示器 */
        .indicator {
            position: absolute;
            top: -20px; /* 放在转盘上方 */
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-bottom: 25px solid #cc0000; /* 红色箭头 */
            z-index: 10;
        }

        /* 6. 按钮样式 */
        button {
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            box-shadow: 0 4px #0056b3;
            transition: background-color 0.1s;
        }

        button:active {
            background-color: #0056b3;
            box-shadow: 0 2px #003d80;
            transform: translateY(2px);
        }
        
        /* 7. 结果显示 */
        #result {
            margin-top: 20px;
            font-size: 1.5em;
            color: #333;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>动态消除转盘</h1>
    
    <div class="wheel-container">
        <div class="indicator"></div>
        <div class="wheel" id="wheel">
            </div>
    </div>

    <button id="spinButton">开始旋转</button>
    
    <p id="result">点击 "开始旋转" 按钮！</p>

    <script>
        // 原始选项列表
        const initialOptions = [
            "Pengajian Am",
            "Biology",
            "Mathematic",
            "ICT"
        ];

        // 当前剩余的选项（会在旋转后移除）
        let currentOptions = [...initialOptions];
        
        // DOM 元素
        const wheel = document.getElementById('wheel');
        const spinButton = document.getElementById('spinButton');
        const resultText = document.getElementById('result');

        // 全局变量
        let totalRotation = 0; // 累计旋转的总度数
        let isSpinning = false; // 旋转状态

        /**
         * 1. 动态生成转盘选项
         */
        function renderWheel() {
            // 清空旧的选项
            wheel.innerHTML = '';
            
            const numSegments = currentOptions.length;
            // 计算每个选项占用的角度
            const segmentAngle = 360 / initialOptions.length; // 注意：这里使用 initialOptions.length 保持扇形大小不变
            
            // 如果所有选项都移除了，显示完成信息
            if (numSegments === 0) {
                resultText.textContent = "所有选项都已选中并移除！";
                spinButton.disabled = true;
                return;
            }

            // 更新 CSS 变量，用于计算文字反向旋转角度
            wheel.style.setProperty('--segments-count', initialOptions.length); 

            // 遍历所有原始选项，创建它们的扇形
            initialOptions.forEach((option, index) => {
                const segment = document.createElement('div');
                segment.classList.add('segment');
                segment.dataset.option = option;
                
                // 设置每个选项的角度和索引
                segment.style.setProperty('--segment-angle', segmentAngle + 'deg');
                segment.style.setProperty('--segment-index', index);
                
                // 添加文字
                const text = document.createElement('div');
                text.classList.add('segment-text');
                text.textContent = option;
                segment.appendChild(text);

                // 如果选项已在 currentOptions 中被移除，则添加 'removed' 类
                if (!currentOptions.includes(option)) {
                    segment.classList.add('removed');
                }
                
                wheel.appendChild(segment);
            });
        }

        /**
         * 2. 开始旋转逻辑
         */
        function spinWheel() {
            if (isSpinning || currentOptions.length === 0) return;
            isSpinning = true;
            spinButton.disabled = true;
            resultText.textContent = "转盘正在旋转中...";
            
            const numSegments = currentOptions.length;
            const segmentAngle = 360 / initialOptions.length; // 每个扇形实际占用的角度
            
            // 随机选择一个 "当前剩余" 选项的索引
            const selectedIndexInCurrent = Math.floor(Math.random() * numSegments);
            const selectedOption = currentOptions[selectedIndexInCurrent];

            // 找到 selectedOption 在 "原始选项" 列表中的索引 (这是扇形在转盘上的固定位置)
            const originalIndex = initialOptions.indexOf(selectedOption);

            // 1. 计算目标位置
            // 目标角度 = 旋转圈数 (至少 5 圈) + 偏移角度
            // 偏移角度：将目标选项的中心线对准指针
            // originalIndex * segmentAngle: 目标扇形起始角度
            // segmentAngle / 2: 目标扇形中心点
            // 360 / initialOptions.length: 扇形大小
            
            // 我们希望指针指向扇形的中心线。指针在 0 度位置。
            // 目标选项的中心在 (originalIndex * segmentAngle + segmentAngle / 2)
            // 需要旋转的度数 = (360 - 目标中心角度)
            const angleToCenter = (originalIndex * segmentAngle) + (segmentAngle / 2);
            let offsetAngle = 360 - angleToCenter;
            
            // 为了让动画效果更明显，我们增加至少 5 圈 (5 * 360度)
            const extraRotations = 5 * 360; 
            
            // 计算新的总旋转度数
            totalRotation += extraRotations + offsetAngle;

            // 2. 应用旋转
            wheel.style.setProperty('--rotation-degree', `${totalRotation}deg`);

            // 3. 监听动画结束
            // 旋转持续时间在 CSS 中定义为 4s
            setTimeout(() => {
                // 3.1 显示结果
                resultText.textContent = `恭喜选中: ${selectedOption}`;
                
                // 3.2 移除选项
                removeSegment(selectedOption);
                
                // 3.3 恢复状态
                isSpinning = false;
                if (currentOptions.length > 0) {
                    spinButton.disabled = false;
                } else {
                    spinButton.disabled = true;
                }

            }, 4000 + 100); // 4000ms (CSS transition) + 100ms 缓冲
        }

        /**
         * 3. 移除选中选项逻辑
         */
        function removeSegment(option) {
            // 从 currentOptions 数组中移除
            currentOptions = currentOptions.filter(item => item !== option);
            
            // 在 DOM 中添加 'removed' 类 (CSS 会将其隐藏)
            const segment = wheel.querySelector(`.segment[data-option="${option}"]`);
            if (segment) {
                segment.classList.add('removed');
            }
            
            // 如果所有选项都移除了，更新状态
            if (currentOptions.length === 0) {
                resultText.textContent = "所有选项都已选中并移除！";
                spinButton.disabled = true;
            }
        }

        /**
         * 4. 初始化
         */
        // 绑定按钮点击事件
        spinButton.addEventListener('click', spinWheel);
        
        // 页面加载时渲染转盘
        renderWheel();
    </script>

</body>
</html>
